\documentclass[12pt,t]{beamer}
\usepackage{graphicx}
\setbeameroption{hide notes}
\setbeamertemplate{note page}[plain]
\usepackage{listings}

\input{LaTeX/header.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% end of header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% title info
\title{1: Intro to Reproducible Research}
\author{}
\date{\href{https://bit.ly/SISBID3}{\tt \color{foreground} bit.ly/SISBID3}}

\begin{document}

% title slide
{
\setbeamertemplate{footline}{} % no page number here
\frame{
  \titlepage
  \note{This is the introductory lecture for the SISBID Workshop on
    Reproducible Research.

A minimal standard for data analysis and other scientific computations
is that they be {\color{nhilit} reproducible}: that the code and data are assembled
in a way so that another group can re-create all of the results (e.g.,
the figures in a paper). The importance of such reproducibility is now
widely recognized, but it is not so widely practiced as it should be,
in large part because many computational scientists (and particularly
statisticians) have not fully adopted the required tools for
reproducible research.
} } }


\begin{frame}[fragile,c]{}

\begin{center}
\begin{minipage}[c]{9.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=9.3cm]
 Karl -- this is very interesting,
 however you used an old version of
 the data (n=143 rather than n=226).

 I'm really sorry you did all that
 work on the incomplete dataset.

 Bruce
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\note{This is an edited version of an email I got from a collaborator,
  in response to an analysis report that I had sent him.

  I try to always include some brief data summaries at the start of
  such reports. By doing so, he immediately saw that I had an old
  version of the data.

  Because I'd set things up carefully, I could just substitute in the
  newer dataset, type ``{\tt make}'', and get the revised report.

  This is a reproducibility success story. But it took me a long
  time to get to this point.
}
\end{frame}


\begin{frame}[c]{}
\centering
{\Large The results in Table 1 don't seem to \\[12pt]
correspond to those in Figure 2.}

\note{My computational life is not entirely rosy. This is the sort of
  email that will freak me out.}
\end{frame}


\begin{frame}[c]{}
\centerline{\Large In what order do I run these scripts?}

\note{Sometimes the process of data file manipulation and data
  cleaning gets spread across a bunch of scripts that need to be
  executed in a particular order. Will I record this information? Is
  it obvious what script does what?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large Where did we get this data file?}

\note{Record the provenance of all data or metadata files.}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large Why did I omit those samples?}

\note{I may decide to omit a few samples. Will I record {\nhilit why}
  I omitted those particular samples?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large How did I make that figure?}

\note{Sometimes, in the midst of a bout of exploratory data analysis,
  I'll create some exciting graph and have a heck of a time
  reproducing it afterwards.}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large ``Your script is now giving an error."}

\note{It was working last week. Well, last month, at least.

How easy is it to go back through that script's history to see where
and why it stopped working?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large ``The attached is similar to the code we used."}

\note{From an email in response to my request for code used for a
  paper.}
\end{frame}






\begin{frame}[c]{}


\centering
\Large

Reproducible

\bigskip

\onslide<2->{{\color{lolit} vs.}}

\bigskip

\only<1|handout 0>{{\color{background} invisible text}}
\only<2>{Replicable}
\only<3 | handout 0>{Correct}

\note{Computational work is
  {\color{nhilit} reproducible} if one can take the data and code and produce
  the same set of results. {\color{nhilit} Replicable} is more stringent: can
  someone repeat the experiment and get the same results?

  Reproducibility is a minimal standard. That something is
  reproducible doesn't imply that it is correct. The code may have bugs. The
  methods may be poorly behaved. There could be experimental
  artifacts.

  (But reproducibility is probably correlated with correctness.)

  Note that some scientists say replicable for what I call
  reproducible, and vice versa.
}
\end{frame}



\begin{frame}{Levels of quality}


\vspace{24pt}

\bi
\itemsep12pt
\item Are the tables and figures reproducible from the code and data?
\item Does the code actually do what you think it does?
\item In addition to {\color{hilit} what} was done, is it clear
  {\color{hilit} why} it was done?
  \bi
  \item[] (e.g., how were parameter settings chosen?)
  \ei
\item Can the code be used for other data?
\item Can you extend the code to do other things?
\ei

\note{Reproducibility is not black and white. And the ideal is hard to
  achieve.
}
\end{frame}



\begin{frame}{Basic principles}


\vspace{24pt}

\bi
\itemsep12pt
\item Project encapsulated in one directory
\item Organize and document
\item Keep track of the {\color{hilit} provenance} of all data files
\item Everything via code
\item Use a version control system
\item Keep track of versions of dependencies
\item Everything automated
\ei

\note{Pointing and clicking is not reproducible. Ideally, you press
  just one button.

Make sure you have all of the data and that you know exactly where it
came from.

But what is {\color{nhilit} raw} data? How far back should you go?
Data that I get from collaborators has usually gone through a
considerable amount of pre-processing. Should we have captured that,
in order for the work to be considered reproducible?

If your collaborator asks, ``In what form would you like the data?''
you should respond, ``In its current form.''
}
\end{frame}





\begin{frame}{Why do we care?}

\vspace{24pt}

\bi
\itemsep12pt
\item Avoid embarrassment
\item More likely correct
\item Save time, in the long run
\item Greater potential for extensions; higher impact
\ei

\note{Doing things properly (writing clear, documented, well-tested
  code) is time consuming, but it could save you a ton of aggravation
  down the road.  Ultimately, you'll be more efficient, and your work
  will have greater impact.

Your code and analyses will be easier to debug, maintain, and extend.
}
\end{frame}



\begin{frame}{Try to avoid}


\vspace{24pt}

\bi
\itemsep12pt
\item Open a file to extract as CSV
\item Open a data file to do even a slight edit
\item Paste results into the text of a manuscript
\item Copy-paste-edit tables
\item Copy-paste-adjust figures
\ei

\note{If you do anything ``by hand'' once, you'll have to do it 100
  times.
}
\end{frame}

\begin{frame}{Problem: Variations across data files}

\vspace{24pt}

\bi
\item Different files (or parts of files!) may have different formats.
\item Variables (or factor levels) may have different names in
  different files.
\item The names of files may inconsistent.
\ei

\bigskip

\bi
\item It's tempting to hand-edit the files. {\vhilit Don't!}
\item Create another meta-data file that explains what's what.
\ei

\note{Scientists aren't trained in how to organize data.

  Multiple people in a lab might have his/her own system, or an
  individual's system may change over time (or from the top to the
  bottom of a file!)

  Create a separate file with meta-data: ``These are the files. In
  this file, the variable is called {\nhilit blah} while in that file it's
  {\nhilit blather}.''

  The meta-data file should be structured as data (e.g., as a comma-
  or tab-delimited file) for easy parsing.
}
\end{frame}



\begin{frame}{Basic tools}


\vspace{24pt}

\bi
\itemsep12pt
\item File organization and naming
\item RMarkdown
\item R packages
\item Version control with git/GitHub
\item Automation with Make
\ei

\note{These are the basic tools that we will cover in this workshop.
  RMarkdown allow preparation of beautiful documents without pointing
  or clicking, and combining code and text.

  R's packaging system is among its best features.

  Version control isn't strictly necessary for reproducibility, but
  once you get the hang of it, you'll never go back.

  Make is for automation and for documenting dependencies. For
  reproducibility, the command line is your best friend.
}
\end{frame}




\begin{frame}[c]{}

\begin{center}
\large
\only<1|handout:0>{
File organization and naming \\
are powerful weapons against chaos.
}
\only<2>{
Your closest collaborator is you six months ago, \\
but you don't reply to emails.
}
\end{center}

\hfill
{\lolit
\only<1|handout:0>{{\textendash} \href{http://www.stat.ubc.ca/~jenny/}{Jenny Bryan}}
\only<2>{(paraphrasing \href{https://twitter.com/kcranstn/status/370914072511791104}{Mark Holder})}
}

\note{The first thing to do is to make your project
  understandable to others (or yourself, later, when you try to figure
  out what it was that you did.

  Segregate all the materials for a project in one directory/folder on
  your harddrive.

  I prefer to separate raw data from processed data, and I put code in
  a separate directory.

  Write {\tt ReadMe} files to explain what's what.
}
\end{frame}



\begin{frame}[fragile]{Organizing your stuff}

\vspace{6pt}

\begin{lstlisting}
Code/d3examples/
    /Others/
    /PyBroman/
    /Rbroman/
    /Rqtl/
    /Rqtlcharts/
Docs/Talks/
    /Meetings/
    /Others/
    /Papers/
    /Resume/
    /Reviews/
    /Travel/
Play/
Projects/AlanAttie/
        /BruceTempel/
        /Hassold_QTL/
        /Hassold_Age/
        /Payseur_Gough/
        /PhyloQTL/
        /Tar/
\end{lstlisting}

\note{This is basically how I organize my hard drive. You want it to be
  clear where things are. You shouldn't be searching for stuff.

  In my {\tt Projects/} directory, I have a {\tt Tar/} directory with
  {\tt tar.gz} files
  of older projects; the same is true for other directories, like
  {\tt Docs/Papers/} and {\tt Docs/Talks/}.
}
\end{frame}


\begin{frame}[fragile]{Organizing your projects}

\vspace{6pt}

\begin{lstlisting}
Projects/Hassold_QTL/

    Data/
    Notes/
    R/
    R/Figs/
    R/Cache/
    Rawdata/
    Refs/

    Makefile
    Readme.txt

    Python/convertGeno.py
    Python/convertPheno.py
    Python/combineData.py

    R/prepData.R
    R/analysis.R
    R/diagnostics.Rmd
    R/qtl_analysis.Rmd
\end{lstlisting}

\note{This is how I'd organize a simple project.

  Separate the raw data from processed data.

  Separate code from data.

  Include a Readme file and a Makefile.

  I tend to reuse file names. Almost every project will have an {\tt
    R/prepData.R} script.

  Of course, each project is under version control (with git)!

  {\tt R/analysis.R} usually has exploratory analyses, and then
  there'll be separate {\tt .Rmd} files with more finalized work.
}
\end{frame}


\begin{frame}[fragile]{Organizing a paper}

\vspace{6pt}

\begin{lstlisting}
Docs/Papers/PhyloQTL/

    Analysis/
    Data/
    Figs/
    Notes/
    R/
    SuppFigs/

    ReadMe.txt
    Makefile
    phyloqtl.tex
    phyloqtl.bib

    Submitted/
    Reviews/
    Revised/
    Final/
    Proofs/
\end{lstlisting}

\note{This is how I organize the material for a paper.

  {\tt R/} contains code for figures; {\tt Analysis/} contains other
  analysis code; {\tt Data/} contains data; {\tt Figs/} contains the
  figures; {\tt Notes/} contains notes or references.

  Of course, a {\tt Makefile} for compiling the PDF, and perhaps a
  {\tt ReadMe} file to explain where things are.

  And I'll save the submitted version (and text files with bits
  for web forms at submission), plus reviews, the revised version plus
  response to reviews, and then the final submitted version and the
  proofs.
}
\end{frame}


\begin{frame}[fragile]{Organizing a talk}

\vspace{6pt}

\begin{lstlisting}
Docs/Talks/SampleMixups/

    Figs/
    R/

    ReadMe.txt
    Makefile
    bmi2013.tex

    Old/
\end{lstlisting}

\note{This is how I organize the material for a talk: much like a
  paper, but generally a bit simpler.

  Again, {\tt R/} contains code for figures and {\tt Figs/} contains
  the actual figures.

  And again, a {\tt Makefile} for compiling the PDF, and perhaps a
  {\tt ReadMe} file to explain where things are.

  And I'll save all old versions in {\tt Old/}
}
\end{frame}




\begin{frame}{Basic principles}

\vspace{18pt}

\bi
\item Develop your own system
\item Put everything in a common directory
\item Be consistent
\bi
\item directory structure; names
\ei
\item Separate raw from processed data
\item Separate code from data
\item It should be obvious what code created what files, and what the
  dependencies are.
\item No hand-editing of data files
\item Don't use spaces in file names
\item Use relative paths, not absolute paths
\bi
\item[] {\tt \hilit ../blah} \; not \; {\tt \vhilit {\textasciitilde}/blah} \; or \; {\tt \vhilit /users/blah}
\ei
\ei

\note{I work on many different projects at the same time, and I'll
  come back to a project 6 months or a year later.

  I don't want to spend much time figuring out where things are
  and how things were created: have a {\tt Makefile}, and keep notes. But
  notes are not necessarily correct while a {\tt Makefile} would be.

  Plan for the whole deal to ultimately be open to others: will you be
  proud of the work, or embarrassed by the mess?
}
\end{frame}




\begin{frame}[c]{}

\vspace{24pt}

\figh{Figs/iso_8601.png}{0.8}

\vfill

\hfill {\tt \footnotesize \lolit \href{http://xkcd.com/1179/}{xkcd.com/1179}}

\note{Go with the xkcd format for writing dates, for ease of sorting.
}
\end{frame}




\begin{frame}{Painful bits}

\vspace{24pt}

\bi
\item Coming up with good names for things
\bi
\item Concise but informative
\item Code as verbs; data as nouns
\item Avoid spaces; avoid symbols except - and \_
\ei
\item Stages of data cleaning
\item Going back and redoing stuff
\item Clutter of old stuff that you no longer need
\item Keeping track of the order of things
\bi
\item dependencies; what gave rise to what
\ei
\ei

\note{I don't have many solutions to these problems. Version control
  helps. And try to break things down into different stages, in
  case one aspect needs to be revised. Maybe use different
  subdirectories for the different stages of data cleaning.

  A point that was raised in the discussion: Have periodic
  ``versions'' for a project, perhaps labeled by date. Move all the
  good stuff over and retire the stuff that is no longer useful or necessary.
}
\end{frame}


\begin{frame}[fragile]{Problem: 80 million side projects}

\vspace{24pt}

\begin{lstlisting}
$ ls ~/Projects/Attie

AimeeNullSims/        Deuterium/             Ping/
AimeeResults/         ExtractData4Gary/      Ping2/
AnnotationFiles/      ForFirstPaper/         Ping3/
Brian/                FromAimee/             Ping4/
Chr10adipose/         GoldStandard/          Play/
Chr6_extrageno/       HumanGWAS/             Proteomics/
Chr6hotspot/          Insulin/               R/
ChrisPlaisier/        Islet_2011-05/         RBM_PlasmaUrine/
Code4Aimee/           Lusis/                 R_adipose/
CompAnnot/            MappingProbes/         R_islet/
CondScans/            Microarrays/           Rawdata/
D2O_2012-02-14/       MultiProbes/           Scans/
D2O_Nrm_2012-02-29/   NewMap/                SimsRePower/
D2O_cellcycle/        Notes/                 Slco1a6/
D2Ocorr/              NullSims/              StudyLineupMethods/
Data4Aimee/           NullSims_2009-09-10/   eQTLPaper/
Data4Tram/            PepIns_2012-02-09/     transeQTL4Lude/
\end{lstlisting}
\note{This is a project-gone-wrong.

  A key problem in research is that you don't really know what you're
  doing when you get started. It seems best to separate out each
  side-project as a separate directory, but it can be a nightmare to
  find things later.

  If each of these subdirectories was nicely organized and had a
  {\tt ReadMe} file, you could {\tt grep} your way through them.

  I sort of like the idea of separate directories for the different
  aspects of mucking about. And second versions are always better. Maybe
  we should plan to muck about separately and then bring a more
  refined analysis back into a common directory?

  A point raised in the discussion:   Put defunct side projects into
  an {\tt Old/} subdirectory, and put active but not yet clearly
  interesting ones into {\tt New/} or {\tt Play/}. This will help to
  avoid the clutter.
}
\end{frame}



\begin{frame}[c]{Keep track of versions of things}

\vspace*{3mm}

\centering

% comic from http://www.phdcomics.com/comics/archive.php?comicid=1531
\only<1>{\figh{Figs/phd101212s.png}{0.8}}

\hfill {\tt \footnotesize \lolit
  \href{http://bit.ly/PhDComics_notFinal}{bit.ly/PhDComics\_notFinal}}

\note{
  Never include ``final'' in a file name.
}
\end{frame}


\begin{frame}<handout:0>[fragile,c]{No ``{\hilit final}'' in file names}


\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                        lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData               necropsy_final_rev2.RData}!
!{\color{foreground}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final_old.RData    rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\end{frame}


\begin{frame}<handout:0>[fragile,c]{No ``{\hilit final}'' in file names}


\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                       }!!{\color{vhilit} lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData              }!!{\color{vhilit} necropsy_final_rev2.RData}!
!{\color{vhilit}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{vhilit}{hypo_mlratio_nqrank_final_old.RData   }!!{\color{foreground} rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\end{frame}






\begin{frame}{And don't forget...}

\vspace{64pt}

\centerline{\Large Backups}

\note{You {\nhilit must} back up your stuff.

      On a Mac, I use the built-in Time Machine, but I also use
      SuperDuper! to create a bootable clone.
}
\end{frame}




\begin{frame}[c]{}

\begin{center}
\large
The most important tool is the {\hilit mindset},\\
when starting, that the end product \\
will be reproducible.
\end{center}

\hfill
{\lolit
{\textendash} \href{http://odin.mdacc.tmc.edu/~kabaggerly/}{Keith Baggerly}
}

\note{So true. Desire for reproducibility is step one.
}
\end{frame}

\end{document}
